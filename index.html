<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Modele na sprzedaż</title>
  <style>
    /* Wycentrowanie strony i tła */
    html, body {
      margin: 0; 
      padding: 0;
      height: 100%;
      font-family: sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start; 
      background-color: #f0f0f0;
    }

    #table-container {
      width: 95%;
      margin-top: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;      /* stały rozkład kolumn */
      white-space: nowrap;      /* wyłącza zawijanie tekstu */
      background-color: #fff;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      text-align: center;       /* wyśrodkowanie tekstu w komórkach */
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px 12px;
      vertical-align: middle;   /* wyśrodkowanie w pionie */
    }

    th {
      background-color: #e0e0e0;
      font-weight: 600;
    }

    /* Stylowanie checkboxa: większy rozmiar, wycentrowanie */
    .checkbox-cell {
      display: flex; 
      justify-content: center; 
      align-items: center;
    }
    .checkbox-cell input[type="checkbox"] {
      width: 20px; 
      height: 20px; 
      cursor: pointer;
    }

    /* Stylowanie input (kolumna Ilość) */
    input[type="number"] {
      width: 70px;
      text-align: center;
      padding: 4px;
    }
  </style>
</head>
<body>
  <div id="table-container"></div>

  <script>
    // URL do CSV (z parametrem output=csv)
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTntplgD3H3MoafVFReoBHcC_p2gYC7zYsqbuKbBncSDAg4YLG92e72QVdvwWvx6JDZHosRtS-uD144/pub?gid=1713753991&single=true&output=csv';

    // Kolumna Sell (index 10) musi mieć wartość "Tak"
    const COLUMN_SELL_INDEX = 10;

    // Indeksy kolumn do wyświetlenia:
    // 0=Series, 1=Year, 3=Toy#, 4=Col.#, 5=Casting, 6=Notes, 7=Set#, 11=Price, 12=szt
    const COLUMNS_TO_SHOW = [0, 1, 3, 4, 5, 6, 7, 11, 12];

    // Etykiety nagłówków (w kolejności COLUMNS_TO_SHOW)
    const HEADERS_NAMES = [
      'Series',
      'Year',
      'Toy #',
      'Col. #',
      'Casting',
      'Notes',
      'Set #',
      'Price',
      'szt'
    ];

    // Funkcja pomocnicza do parsowania integera
    function parseIntOr(val, defaultVal = 1) {
      const parsed = parseInt(val, 10);
      return isNaN(parsed) ? defaultVal : parsed;
    }

    fetch(csvUrl)
      .then(response => response.text())
      .then(csvData => {
        // Rozbijamy na wiersze i usuwamy ewentualne puste
        const lines = csvData.split('\n')
          .map(line => line.trim())
          .filter(line => line !== '');

        // Dzielimy każdą linię po przecinku (proste założenie CSV bez przecinków w wartościach)
        const allRows = lines.map(line => line.split(','));

        if (allRows.length < 2) {
          throw new Error('Zbyt mało wierszy w CSV.');
        }

        // Pierwszy wiersz to nagłówki (których i tak zaraz nie użyjemy), 
        // a bodyRows to reszta wierszy
        const bodyRows = allRows.slice(1);

        // --- FILTR: wyświetlamy tylko wiersze, gdzie Sell == "Tak" ---
        const filteredRows = bodyRows.filter(row => {
          // row[10] => kolumna Sell
          const sellValue = (row[COLUMN_SELL_INDEX] || '').toLowerCase().trim();
          return (sellValue === 'tak');
        });

        // Budowa tabeli HTML
        const table = document.createElement('table');

        // === THEAD ===
        const thead = document.createElement('thead');
        const headerRow = document.createElement('tr');

        // Tworzymy nagłówki wg HEADERS_NAMES
        HEADERS_NAMES.forEach(name => {
          const th = document.createElement('th');
          th.textContent = name;
          headerRow.appendChild(th);
        });

        // Dodajemy 2 nowe kolumny (Wybierz, Ilość)
        const thWybierz = document.createElement('th');
        thWybierz.textContent = 'Wybierz';
        headerRow.appendChild(thWybierz);

        const thIlosc = document.createElement('th');
        thIlosc.textContent = 'Ilość';
        headerRow.appendChild(thIlosc);

        thead.appendChild(headerRow);
        table.appendChild(thead);

        // === TBODY ===
        const tbody = document.createElement('tbody');

        // Generujemy wiersze
        filteredRows.forEach(row => {
          const tr = document.createElement('tr');

          // Dla każdej z kolumn w COLUMNS_TO_SHOW
          COLUMNS_TO_SHOW.forEach(colIndex => {
            const td = document.createElement('td');
            td.textContent = row[colIndex] || '';
            tr.appendChild(td);
          });

          // 1) Kolumna "Wybierz" (checkbox)
          const tdCheck = document.createElement('td');
          tdCheck.classList.add('checkbox-cell'); 
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          tdCheck.appendChild(checkbox);
          tr.appendChild(tdCheck);

          // 2) Kolumna "Ilość" (input number)
          const tdNumber = document.createElement('td');
          const inputNumber = document.createElement('input');
          inputNumber.type = 'number';
          inputNumber.min = '1';

          // Ustalamy max na wartość z kolumny 'szt' (index 12)
          const sztValue = parseIntOr(row[12], 1);
          if (sztValue >= 1) {
            inputNumber.max = sztValue.toString();
          } else {
            inputNumber.max = '1';
          }
          // Domyślna wartość
          inputNumber.value = '1';

          tdNumber.appendChild(inputNumber);
          tr.appendChild(tdNumber);

          tbody.appendChild(tr);
        });

        table.appendChild(tbody);

        // Wstawiamy tabelę do kontenera
        const container = document.getElementById('table-container');
        container.innerHTML = ''; // wyczyszczenie
        container.appendChild(table);
      })
      .catch(err => console.error('Błąd pobierania/parowania CSV:', err));
  </script>
</body>
</html>
