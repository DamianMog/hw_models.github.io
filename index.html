<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Modele na sprzedaż</title>
  <style>
    /* Cała strona wyśrodkowana */
    html, body {
      margin: 0; 
      padding: 0;
      height: 100%;
      font-family: sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start; /* by strona zaczynała się u góry */
      background-color: #f0f0f0;
    }

    #table-container {
      width: 95%; /* tabela zajmie ~95% szerokości ekranu */
      margin-top: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;      /* stały rozkład kolumn */
      white-space: nowrap;      /* wyłącza zawijanie tekstu */
      background-color: #fff;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      text-align: center;       /* wyśrodkowanie tekstu w komórkach */
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px 12px;
      vertical-align: middle;   /* wyśrodkowanie w pionie */
    }

    th {
      background-color: #e0e0e0;
      font-weight: 600;
    }

    /* Stylowanie checkboxa - większy rozmiar i wycentrowanie */
    .checkbox-cell {
      display: flex; 
      justify-content: center; 
      align-items: center;
    }
    .checkbox-cell input[type="checkbox"] {
      width: 20px; 
      height: 20px; 
      cursor: pointer;
    }

    /* Stylowanie input (kolumna Ilość) */
    input[type="number"] {
      width: 70px;
      text-align: center;
      padding: 4px;
    }
  </style>
</head>
<body>
  <div id="table-container"></div>

  <script>
    // URL do CSV
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTntplgD3H3MoafVFReoBHcC_p2gYC7zYsqbuKbBncSDAg4YLG92e72QVdvwWvx6JDZHosRtS-uD144/pub?gid=1713753991&single=true&output=csv';

    // Indeksy kolumn, które chcemy zachować (Series, Year, Toy #, Col. #, Casting, Notes, Set #, Price, szt).
    // Wg wcześniejszych ustaleń: 
    //   0=Series, 1=Year, 3=Toy#, 4=Col.#, 5=Casting, 6=Notes, 7=Set#, 11=Price, 12=szt
    // Następnie dodamy kolumny: Wybierz, Ilość (dynamicznie)
    const COLUMNS_TO_SHOW = [0, 1, 3, 4, 5, 6, 7, 11, 12];

    // Nazwy nagłówków (opcjonalnie możemy użyć oryginalnych z CSV, ale tutaj chcemy je
    // mieć w konkretnej kolejności i ewentualnie zmienione nazwy).
    const HEADERS_NAMES = [
      'Series',
      'Year',
      'Toy #',
      'Col. #',
      'Casting',
      'Notes',
      'Set #',
      'Price',
      'szt'
    ];

    // Pomocnicza funkcja do parsowania integera
    function parseIntOr(val, defaultVal = 1) {
      const parsed = parseInt(val, 10);
      return isNaN(parsed) ? defaultVal : parsed;
    }

    fetch(csvUrl)
      .then(response => response.text())
      .then(csvData => {
        // Rozbijamy na wiersze
        const lines = csvData.split('\n').map(l => l.trim()).filter(l => l !== '');
        // Każdy wiersz -> tablica kolumn
        // Uwaga: proste split(',') może być problematyczne przy przecinkach w danych.
        // Jeśli dane są proste, to wystarczy. W innym wypadku => PapaParse / inna biblioteka.
        const data = lines.map(line => line.split(','));

        if (data.length < 2) {
          throw new Error('Za mało wierszy w CSV');
        }

        // Pierwszy wiersz to nagłówki (ale i tak je nadpiszemy HEADERS_NAMES, jeśli chcemy).
        // W razie czego oryginalne: const originalHeaders = data[0];
        let bodyRows = data.slice(1); // reszta to wiersze z danymi

        // Budujemy tabelę
        const table = document.createElement('table');

        // === THEAD ===
        const thead = document.createElement('thead');
        const headerRow = document.createElement('tr');

        // Dodajemy nagłówki z HEADERS_NAMES w kolejności COLUMNS_TO_SHOW
        COLUMNS_TO_SHOW.forEach((colIndex, i) => {
          const th = document.createElement('th');
          // Wstawiamy nazwę z HEADERS_NAMES (lub oryginalną z CSV, jeśli wolisz)
          th.textContent = HEADERS_NAMES[i] || '';
          headerRow.appendChild(th);
        });

        // Dodatkowe 2 kolumny (Wybierz, Ilość)
        const thWybierz = document.createElement('th');
        thWybierz.textContent = 'Wybierz';
        headerRow.appendChild(thWybierz);

        const thIlosc = document.createElement('th');
        thIlosc.textContent = 'Ilość';
        headerRow.appendChild(thIlosc);

        thead.appendChild(headerRow);
        table.appendChild(thead);

        // === TBODY ===
        const tbody = document.createElement('tbody');

        // Generujemy wiersze danych
        bodyRows.forEach(row => {
          const tr = document.createElement('tr');

          // Dla każdej kolumny z COLUMNS_TO_SHOW
          COLUMNS_TO_SHOW.forEach(colIndex => {
            const td = document.createElement('td');
            // Jeśli w CSV brakuje kolumny (row[colIndex] = undefined), wstaw pusty
            td.textContent = row[colIndex] || '';
            tr.appendChild(td);
          });

          // 1) Kolumna "Wybierz" (checkbox) wycentrowany
          const tdCheck = document.createElement('td');
          tdCheck.classList.add('checkbox-cell'); // klasa do wycentrowania

          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          // Powiększony został w CSS .checkbox-cell input[type="checkbox"] { width:20px; height:20px; }
          tdCheck.appendChild(checkbox);
          tr.appendChild(tdCheck);

          // 2) Kolumna "Ilość" (input type=number)
          const tdNumber = document.createElement('td');
          const inputNumber = document.createElement('input');
          inputNumber.type = 'number';
          inputNumber.min = '1';
          // Maks = wartość z kolumny "szt" (index 12) lub 1
          const sztValue = parseIntOr(row[12], 1);
          // Ustalamy max na sztValue (lub ewentualnie to samo - nic nie odejmujemy)
          // bo: "Input w kolumnie ILOŚĆ ustaw wartość MAX na taką samą lub mniejszą jak wartość w kolumnie 'szt'."
          // => max = sztValue
          if (sztValue >= 1) {
            inputNumber.max = sztValue.toString();
          } else {
            inputNumber.max = '1';
          }
          // Domyślna wartość = 1
          inputNumber.value = '1';

          tdNumber.appendChild(inputNumber);
          tr.appendChild(tdNumber);

          tbody.appendChild(tr);
        });

        table.appendChild(tbody);

        // Wstawiamy tabelę do kontenera
        const container = document.getElementById('table-container');
        container.innerHTML = ''; // czyścimy na wszelki wypadek
        container.appendChild(table);
      })
      .catch(err => {
        console.error('Błąd odczytu/parowania CSV:', err);
      });
  </script>
</body>
</html>
