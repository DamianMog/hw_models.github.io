<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Modele na sprzedaż</title>
  <style>
    table {
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px 12px;
    }
    th {
      background-color: #f5f5f5;
    }
    input[type="number"] {
      width: 80px;
    }
  </style>
</head>
<body>
  <h1>Modele na sprzedaż (kolumna K = "Tak")</h1>

  <div id="table-container"></div>

  <script>
    // Link do pliku CSV
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTntplgD3H3MoafVFReoBHcC_p2gYC7zYsqbuKbBncSDAg4YLG92e72QVdvwWvx6JDZHosRtS-uD144/pub?gid=1713753991&single=true&output=csv';

    // Kolumny, które chcemy ukryć
    // C(2), I(8), J(9), K(10), N(13)
    const HIDDEN_COLUMNS = [2, 8, 9, 10, 13];

    // Filtr kolumny K (index 10) => "Tak"
    const COLUMN_K_INDEX = 10;
    const VALUE_TO_MATCH = 'tak';

    // Kolumna M (index 12) - maksymalna liczba szt. do inputa
    const COLUMN_M_INDEX = 12;

    // Dla bezpieczeństwa ograniczamy liczbę kolumn, żeby nie wyświetlać dalekich kolumn
    const MAX_COLUMN_INDEX = 20;

    // Pomocnicza funkcja do przerobienia stringa na liczbę (lub 1)
    function parseIntOr(val, defaultVal = 1) {
      const parsed = parseInt(val, 10);
      return isNaN(parsed) ? defaultVal : parsed;
    }

    fetch(csvUrl)
      .then(response => response.text())
      .then(csvData => {
        // 1) Podział na wiersze
        //    usuwamy ewentualne puste linie np. .filter(line => line.trim() !== '') w razie potrzeby
        const rows = csvData.split('\n').map(line => line.trim()).filter(line => line !== '');
        
        // 2) Każdy wiersz dzielimy po przecinku -> tablica kolumn
        //    Uwaga: proste split(',') może się wyłożyć, jeśli w arkuszu są przecinki w komórkach,
        //    ale zakładamy, że ich nie ma lub używamy CSV w najprostszym formacie.
        const data = rows.map(row => row.split(','));

        if (data.length < 2) {
          throw new Error('Brak danych lub za mało wierszy w CSV.');
        }

        // Pierwszy wiersz => nagłówki
        const headers = data[0];
        // Kolejne wiersze => dane
        let bodyRows = data.slice(1);

        // 3) Filtr: wyświetlamy tylko wiersze, w których kolumna K(10) == "Tak"
        bodyRows = bodyRows.filter(r => {
          const val = (r[COLUMN_K_INDEX] || '').toString().trim().toLowerCase();
          return val === VALUE_TO_MATCH;
        });

        // === BUDUJEMY TABELĘ HTML ===
        const table = document.createElement('table');

        // --- THEAD ---
        const thead = document.createElement('thead');
        const headerRow = document.createElement('tr');

        // Dodajemy komórki nagłówkowe (z pominięciem ukrytych kolumn)
        headers.forEach((headerText, colIndex) => {
          if (colIndex <= MAX_COLUMN_INDEX && !HIDDEN_COLUMNS.includes(colIndex)) {
            const th = document.createElement('th');
            th.textContent = headerText;
            headerRow.appendChild(th);
          }
        });

        // Dodajemy 2 nowe kolumny do nagłówka
        // 1) Wybierz (checkbox)
        const thSelect = document.createElement('th');
        thSelect.textContent = 'Wybierz';
        headerRow.appendChild(thSelect);

        // 2) Ilość (input number)
        const thQty = document.createElement('th');
        thQty.textContent = 'Ilość';
        headerRow.appendChild(thQty);

        thead.appendChild(headerRow);
        table.appendChild(thead);

        // --- TBODY ---
        const tbody = document.createElement('tbody');

        bodyRows.forEach(row => {
          const tr = document.createElement('tr');

          // Przetwarzamy każdą kolumnę w wierszu
          row.forEach((cellValue, colIndex) => {
            if (colIndex <= MAX_COLUMN_INDEX && !HIDDEN_COLUMNS.includes(colIndex)) {
              const td = document.createElement('td');
              td.textContent = cellValue;
              tr.appendChild(td);
            }
          });

          // 1) Kolumna z checkboxem
          const tdCheck = document.createElement('td');
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          tdCheck.appendChild(checkbox);
          tr.appendChild(tdCheck);

          // 2) Kolumna z <input type="number">
          const tdNumber = document.createElement('td');
          const inputNum = document.createElement('input');
          inputNum.type = 'number';
          inputNum.min = '1';

          // Ustal max = (wartość w kolumnie M) - 1
          const mValue = parseIntOr(row[COLUMN_M_INDEX], 1);
          if (mValue > 1) {
            inputNum.max = (mValue - 1).toString();
          } else {
            inputNum.max = '1';
          }
          inputNum.value = '1'; // domyślna wartość

          tdNumber.appendChild(inputNum);
          tr.appendChild(tdNumber);

          tbody.appendChild(tr);
        });

        table.appendChild(tbody);

        // Wstawiamy gotową tabelę do kontenera
        document.getElementById('table-container').appendChild(table);
      })
      .catch(err => {
        console.error('Błąd odczytu CSV:', err);
      });
  </script>
</body>
</html>
