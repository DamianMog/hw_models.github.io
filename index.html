<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Modele na sprzedaż</title>
  <style>
    table {
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px 12px;
    }
    th {
      background-color: #f5f5f5;
    }
  </style>
  <!-- Wczytujemy bibliotekę SheetJS (XLSX) z CDN -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
  <h1>Modele na sprzedaż (filtr: kolumna K = "Tak")</h1>
  
  <div id="table-container"></div>
  
  <script>
    // Link do pliku XLSX opublikowanego z Google Sheets
    const xlsxUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTntplgD3H3MoafVFReoBHcC_p2gYC7zYsqbuKbBncSDAg4YLG92e72QVdvwWvx6JDZHosRtS-uD144/pub?output=xlsx';

    // Definicje kolumn
    // A=0, B=1, C=2, ..., K=10, L=11, M=12, N=13, O=14 ...
    const COLUMN_K_INDEX = 10;          // K
    const VALUE_TO_MATCH = 'tak';       // Filtr (małe litery)
    const HIDDEN_COLUMNS = [2, 8, 9];   // C(2), I(8), J(9)
    const MAX_COLUMN_INDEX = 13;        // Pow. kolumny N(13) ukrywamy

    fetch(xlsxUrl)
      .then(response => response.arrayBuffer()) // pobieramy plik XLSX jako ArrayBuffer
      .then(arrayBuffer => {
        // Odczytujemy plik XLSX
        const workbook = XLSX.read(arrayBuffer, { type: 'array' });

        // Wybieramy nazwę pierwszego arkusza (lub innego, jeśli trzeba)
        const sheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[sheetName];

        // Konwertujemy arkusz na dwuwymiarową tablicę (array of arrays)
        // header: 1 => nie traktuje pierwszego wiersza jako klucze obiektu,
        // tylko zwraca wszystko jako tablicę
        const data = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

        if (data.length === 0) {
          throw new Error('Arkusz jest pusty lub nie ma danych.');
        }

        // Pierwszy wiersz w 'data' to nagłówki (tablica strings)
        const headers = data[0];
        // Pozostałe wiersze to dane
        const rows = data.slice(1);

        // Filtrujemy wiersze => kolumna K (index 10) == "Tak"
        // Uwaga: sprawdzamy, czy istnieje dana kolumna, i czy wartości są stringami.
        const filteredRows = rows.filter(row => {
          // row to tablica [col0, col1, col2, ...]
          const cellValue = (row[COLUMN_K_INDEX] || '').toString().trim().toLowerCase();
          return cellValue === VALUE_TO_MATCH;
        });

        // Teraz budujemy tabelę HTML
        const table = document.createElement('table');

        // === Nagłówki ===
        const thead = document.createElement('thead');
        const headerRow = document.createElement('tr');

        // Przechodzimy przez 'headers' od lewej do prawej
        // Usuwamy kolumny C(2), I(8), J(9), > N(13)
        headers.forEach((headerText, index) => {
          if (index <= MAX_COLUMN_INDEX && !HIDDEN_COLUMNS.includes(index)) {
            const th = document.createElement('th');
            th.textContent = headerText || ''; 
            headerRow.appendChild(th);
          }
        });

        thead.appendChild(headerRow);
        table.appendChild(thead);

        // === Dane (tbody) ===
        const tbody = document.createElement('tbody');

        filteredRows.forEach(row => {
          const tr = document.createElement('tr');
          // row to np. ["VW", "2020", "Tak", ...] (zależnie od arkusza)
          row.forEach((cellValue, colIndex) => {
            if (colIndex <= MAX_COLUMN_INDEX && !HIDDEN_COLUMNS.includes(colIndex)) {
              const td = document.createElement('td');
              td.textContent = (cellValue === undefined) ? '' : cellValue;
              tr.appendChild(td);
            }
          });
          tbody.appendChild(tr);
        });

        table.appendChild(tbody);

        // Wstawiamy tabelę do kontenera w HTML
        document.getElementById('table-container').appendChild(table);
      })
      .catch(error => {
        console.error('Błąd podczas pobierania / parsowania XLSX:', error);
      });
  </script>
</body>
</html>
