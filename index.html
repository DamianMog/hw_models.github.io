<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Modele na sprzedaż</title>
  
  <style>
    /* Podstawowe style/reset */
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    /* Zapobieganie zaznaczaniu elementów */
    tr, img {
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    /* Tabela z listą modeli */
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
      /* Pozwala na zawijanie tekstu */
      white-space: normal;
    }
    th {
      background-color: #f4f4f4;
    }

    /*
     * Możesz usunąć style do obrazków, jeśli nie używasz kolumn ze zdjęciami
     * Zachowujemy je, jeśli w przyszłości chciałbyś wstawić zdjęcia
     */
    img {
      max-width: 100px;
      cursor: pointer;
    }

    /* Wyróżnienie wiersza wybranego (jeśli potrzebne) */
    tr.selected {
      background-color: #caf0f8;
    }

    /* Prosty styl input[type="checkbox"] i input[type="number"] */
    input[type="checkbox"] {
      transform: scale(1.3); /* powiększamy checkbox */
      cursor: pointer;
    }
    input[type="number"] {
      width: 80px;
      text-align: center;
    }
  </style>
</head>
<body>

  <h1>Lista modeli na sprzedaż</h1>

  <!-- Kontener, w którym wstawimy tabelę z CSV -->
  <div id="table-container">
    <p>Wczytywanie danych...</p>
  </div>

  <script>
    /*********************************************************
     * KONFIGURACJA
     *********************************************************/
    // URL do CSV (z parametrem ?output=csv)
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTntplgD3H3MoafVFReoBHcC_p2gYC7zYsqbuKbBncSDAg4YLG92e72QVdvwWvx6JDZHosRtS-uD144/pub?gid=1713753991&single=true&output=csv';

    // Indeks kolumny Sell (filtr == "Tak")
    const COLUMN_SELL = 10;

    // Kolumny do wyświetlenia (bez Notes (6)):
    // [0=Series, 1=Year, 3=Toy #, 4=Col.#, 5=Casting, 7=Set #, 11=Price, 12=szt]
    const COLUMNS_TO_SHOW = [0, 1, 3, 4, 5, 7, 11, 12];

    // Etykiety nagłówków w tej samej kolejności co COLUMNS_TO_SHOW
    const HEADERS = [
      'Series',
      'Year',
      'Toy #',
      'Col. #',
      'Casting',
      'Set #',
      'Price',
      'szt'
    ];

    /*********************************************************
     * FUNKCJE POMOCNICZE
     *********************************************************/
    function parseIntOr(val, def = 1) {
      const num = parseInt(val, 10);
      return isNaN(num) ? def : num;
    }

    /*********************************************************
     * GŁÓWNA LOGIKA: POBRANIE CSV, PARSOWANIE, FILTROWANIE
     *********************************************************/
    fetch(csvUrl)
      .then(response => {
        if (!response.ok) {
          throw new Error(`Błąd sieci: ${response.status}`);
        }
        return response.text();
      })
      .then(csvData => {
        // Podział na wiersze, usuwamy puste
        const lines = csvData.split('\n')
          .map(line => line.trim())
          .filter(line => line !== '');

        // Każdy wiersz => tablica kolumn (split po przecinku)
        const allRows = lines.map(line => line.split(','));

        if (allRows.length < 2) {
          throw new Error('CSV: za mało wierszy (brak danych).');
        }

        // Pierwszy wiersz - oryginalne nagłówki (tu nieużywane)
        // Drugi i dalsze wiersze - faktyczne dane
        const bodyRows = allRows.slice(1);

        // FILTR: Tylko wiersze, gdzie kolumna SELL (10) == "Tak" (ignoreCase)
        const filteredRows = bodyRows.filter(row => {
          const sellVal = (row[COLUMN_SELL] || '').trim().toLowerCase();
          return sellVal === 'tak';
        });

        // Tworzymy tabelę
        const table = document.createElement('table');

        // THEAD
        const thead = document.createElement('thead');
        const headerRow = document.createElement('tr');

        // Dodajemy nagłówki (z HEADERS)
        HEADERS.forEach(h => {
          const th = document.createElement('th');
          th.textContent = h;
          headerRow.appendChild(th);
        });

        // Dodatkowe 2 kolumny: "Wybierz" i "Ilość"
        const thSelect = document.createElement('th');
        thSelect.textContent = 'Wybierz';
        headerRow.appendChild(thSelect);

        const thQty = document.createElement('th');
        thQty.textContent = 'Ilość';
        headerRow.appendChild(thQty);

        thead.appendChild(headerRow);
        table.appendChild(thead);

        // TBODY
        const tbody = document.createElement('tbody');

        filteredRows.forEach(row => {
          const tr = document.createElement('tr');

          // Wypełniamy kolumny wg COLUMNS_TO_SHOW
          COLUMNS_TO_SHOW.forEach(index => {
            const td = document.createElement('td');
            td.textContent = row[index] || '';
            tr.appendChild(td);
          });

          // 1) Kolumna "Wybierz" (checkbox)
          const tdSelect = document.createElement('td');
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          tdSelect.appendChild(checkbox);
          tr.appendChild(tdSelect);

          // 2) Kolumna "Ilość" (input number)
          const tdQty = document.createElement('td');
          const inputNumber = document.createElement('input');
          inputNumber.type = 'number';
          inputNumber.min = '1';

          // max = wartość w kolumnie 12 (szt), jeśli prawidłowa
          const sztValue = parseIntOr(row[12], 1);
          inputNumber.max = sztValue.toString();
          inputNumber.value = '1';

          tdQty.appendChild(inputNumber);
          tr.appendChild(tdQty);

          tbody.appendChild(tr);
        });

        table.appendChild(tbody);

        // Wyświetlamy
        const container = document.getElementById('table-container');
        container.innerHTML = '';  // czyścimy ewentualne info
        container.appendChild(table);
      })
      .catch(err => {
        console.error('Błąd podczas pobierania/parowania CSV:', err);
        document.getElementById('table-container').innerHTML =
          '<p>Wystąpił błąd podczas wczytywania danych.</p>';
      });
  </script>
</body>
</html>
