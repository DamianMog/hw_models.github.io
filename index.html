<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Odczyt z Google Sheets (HTML)</title>
  <style>
    table {
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px 12px;
    }
    th {
      background-color: #f5f5f5;
    }
  </style>
</head>
<body>
  <h1>Filtr: Tylko wiersze z kolumną K = "Tak"</h1>
  
  <div id="table-container"></div>
  
  <script>
    // Nowy link do pliku jako strona HTML (pubhtml)
    const sheetHtmlUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTntplgD3H3MoafVFReoBHcC_p2gYC7zYsqbuKbBncSDAg4YLG92e72QVdvwWvx6JDZHosRtS-uD144/pubhtml?gid=1713753991&single=true';

    // Kolumna K to indeks 10 (0=A, 1=B, ..., 10=K)
    const COLUMN_K_INDEX = 10;
    const VALUE_TO_MATCH = 'tak'; // użyjemy toLowerCase() dla pewności

    fetch(sheetHtmlUrl)
      .then(response => response.text())
      .then(htmlString => {
        // (1) Parsujemy całą stronę HTML
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlString, 'text/html');

        // (2) Wyszukujemy oryginalną tabelę w dokumencie
        // Zwykle Google publikuje arkusz w postaci <table> z thead/tbody
        const originalTable = doc.querySelector('table');
        if (!originalTable) {
          throw new Error('Nie znaleziono tabeli w pobranym dokumencie.');
        }

        // (3) Wyciągamy nagłówek tabeli (<thead>)
        const thead = originalTable.querySelector('thead');
        
        // Wyciągamy wiersze (<tr>) z ciała tabeli (<tbody>)
        const rows = originalTable.querySelectorAll('tbody tr');

        // (4) Filtrowanie wierszy
        // Tylko te, w których kolumna K (indeks 10) == "Tak" (nieważne czy wielkie/małe litery)
        const filteredRows = [];
        rows.forEach(tr => {
          const cells = tr.querySelectorAll('td');
          // Upewniamy się, że wiersz ma wystarczającą liczbę kolumn
          if (cells.length > COLUMN_K_INDEX) {
            const cellValue = cells[COLUMN_K_INDEX].innerText.trim().toLowerCase();
            if (cellValue === VALUE_TO_MATCH) {
              filteredRows.push(tr);
            }
          }
        });

        // (5) Budujemy nową tabelę w dokumencie
        const newTable = document.createElement('table');

        // Klonujemy thead z oryginalnej tabeli (jeśli istnieje)
        if (thead) {
          const clonedThead = thead.cloneNode(true);
          newTable.appendChild(clonedThead);
        }

        // Tworzymy <tbody> i dodajemy przefiltrowane wiersze
        const newTbody = document.createElement('tbody');
        filteredRows.forEach(tr => {
          // klonujemy gotowy wiersz (zawierający <td>)
          newTbody.appendChild(tr.cloneNode(true));
        });

        newTable.appendChild(newTbody);

        // (6) Dodajemy nową tabelę do strony
        document.getElementById('table-container').appendChild(newTable);
      })
      .catch(err => {
        console.error('Błąd przy pobieraniu/parowaniu HTML:', err);
      });
  </script>
</body>
</html>
